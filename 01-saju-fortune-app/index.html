<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì£¼ ìš´ì„¸ ë¶„ì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .result-section {
            display: none;
        }
        
        .result-section.show {
            display: block;
        }
        
        .saju-display {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .saju-display h2 {
            color: #d35400;
            margin-bottom: 15px;
        }
        
        .pillars {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .pillar {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .pillar-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .pillar-content {
            font-size: 24px;
            font-weight: 700;
            color: #d35400;
        }
        
        .fortune-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .fortune-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .fortune-title {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .fortune-content {
            color: #555;
            line-height: 1.8;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”® ì‚¬ì£¼ ìš´ì„¸ ë¶„ì„</h1>
        
        <div class="input-section">
            <div class="form-group">
                <label>ìƒë…„ì›”ì¼</label>
                <input type="date" id="birthDate" max="2025-01-09">
            </div>
            
            <div class="form-group">
                <label>íƒœì–´ë‚œ ì‹œê°„</label>
                <div class="time-inputs">
                    <select id="birthHour">
                        <option value="">ì‹œ ì„ íƒ</option>
                        <option value="23">ìì‹œ (23:00-01:00)</option>
                        <option value="1">ì¶•ì‹œ (01:00-03:00)</option>
                        <option value="3">ì¸ì‹œ (03:00-05:00)</option>
                        <option value="5">ë¬˜ì‹œ (05:00-07:00)</option>
                        <option value="7">ì§„ì‹œ (07:00-09:00)</option>
                        <option value="9">ì‚¬ì‹œ (09:00-11:00)</option>
                        <option value="11">ì˜¤ì‹œ (11:00-13:00)</option>
                        <option value="13">ë¯¸ì‹œ (13:00-15:00)</option>
                        <option value="15">ì‹ ì‹œ (15:00-17:00)</option>
                        <option value="17">ìœ ì‹œ (17:00-19:00)</option>
                        <option value="19">ìˆ ì‹œ (19:00-21:00)</option>
                        <option value="21">í•´ì‹œ (21:00-23:00)</option>
                    </select>
                    <select id="gender">
                        <option value="">ì„±ë³„ ì„ íƒ</option>
                        <option value="male">ë‚¨ì„±</option>
                        <option value="female">ì—¬ì„±</option>
                    </select>
                </div>
            </div>
            
            <button onclick="analyzeSaju()">ìš´ì„¸ ë¶„ì„í•˜ê¸°</button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>ì‚¬ì£¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
        
        <div id="result" class="result-section">
            <div class="saju-display">
                <h2>ë‹¹ì‹ ì˜ ì‚¬ì£¼íŒ”ì</h2>
                <div class="pillars">
                    <div class="pillar">
                        <div class="pillar-title">ë…„ì£¼ (å¹´æŸ±)</div>
                        <div class="pillar-content" id="yearPillar"></div>
                    </div>
                    <div class="pillar">
                        <div class="pillar-title">ì›”ì£¼ (æœˆæŸ±)</div>
                        <div class="pillar-content" id="monthPillar"></div>
                    </div>
                    <div class="pillar">
                        <div class="pillar-title">ì¼ì£¼ (æ—¥æŸ±)</div>
                        <div class="pillar-content" id="dayPillar"></div>
                    </div>
                    <div class="pillar">
                        <div class="pillar-title">ì‹œì£¼ (æ™‚æŸ±)</div>
                        <div class="pillar-content" id="hourPillar"></div>
                    </div>
                </div>
            </div>
            
            <div class="fortune-card">
                <div class="fortune-title">ğŸ’‘ ê²°í˜¼ìš´</div>
                <div class="fortune-content" id="marriageFortune"></div>
            </div>
            
            <div class="fortune-card">
                <div class="fortune-title">ğŸ’• ì—°ì• ìš´</div>
                <div class="fortune-content" id="loveFortune"></div>
            </div>
            
            <div class="fortune-card">
                <div class="fortune-title">ğŸ’¼ ì§ì¥ìš´</div>
                <div class="fortune-content" id="careerFortune"></div>
            </div>
            
            <div class="fortune-card">
                <div class="fortune-title">ğŸ’° ì‚¬ì—…ìš´</div>
                <div class="fortune-content" id="businessFortune"></div>
            </div>
            
            <div class="fortune-card">
                <div class="fortune-title">âœ¨ 2026ë…„ ìš´ì„¸</div>
                <div class="fortune-content" id="yearFortune"></div>
            </div>
            
            <div class="fortune-card">
                <div class="fortune-title">ğŸ§  ì‚¬ì£¼ë¡œ ë³´ëŠ” MBTI ì„±í–¥</div>
                <div class="fortune-content" id="mbtiFortune"></div>
            </div>
        </div>
    </div>

    <!-- Korean Lunar Calendar ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/korean-lunar-calendar/dist/korean-lunar-calendar.min.js"></script>
    
    <script>
        // ì‹œì£¼ ê³„ì‚°ì„ ìœ„í•œ ì²œê°„ ë°°ì—´
        const heavenlyStems = ['ê°‘', 'ì„', 'ë³‘', 'ì •', 'ë¬´', 'ê¸°', 'ê²½', 'ì‹ ', 'ì„', 'ê³„'];
        const earthlyBranches = ['ì', 'ì¶•', 'ì¸', 'ë¬˜', 'ì§„', 'ì‚¬', 'ì˜¤', 'ë¯¸', 'ì‹ ', 'ìœ ', 'ìˆ ', 'í•´'];
        
        // í•œìë¥¼ í•œê¸€ë¡œ ë³€í™˜
        function chineseToKorean(chinese) {
            const mapping = {
                'ç”²': 'ê°‘', 'ä¹™': 'ì„', 'ä¸™': 'ë³‘', 'ä¸': 'ì •', 'æˆŠ': 'ë¬´', 
                'å·±': 'ê¸°', 'åºš': 'ê²½', 'è¾›': 'ì‹ ', 'å£¬': 'ì„', 'ç™¸': 'ê³„',
                'å­': 'ì', 'ä¸‘': 'ì¶•', 'å¯…': 'ì¸', 'å¯': 'ë¬˜', 'è¾°': 'ì§„', 'å·³': 'ì‚¬',
                'åˆ': 'ì˜¤', 'æœª': 'ë¯¸', 'ç”³': 'ì‹ ', 'é…‰': 'ìœ ', 'æˆŒ': 'ìˆ ', 'äº¥': 'í•´'
            };
            return chinese.split('').map(c => mapping[c] || c).join('');
        }
        
        // ì¼ê°„ì— ë”°ë¥¸ ì‹œì£¼ ì²œê°„ ê³„ì‚°
        function getHourStem(dayStem, hourBranch) {
            const dayStemIndex = heavenlyStems.indexOf(dayStem);
            const hourBranchIndex = earthlyBranches.indexOf(hourBranch);
            
            // ì¼ê°„ì— ë”°ë¥¸ ì‹œê°„ ì²œê°„ ê³„ì‚° ê³µì‹
            const hourStemIndex = (dayStemIndex * 2 + hourBranchIndex) % 10;
            return heavenlyStems[hourStemIndex];
        }
        
        // ì •í™•í•œ ì‚¬ì£¼ ê³„ì‚° (í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€)
        function calculateSaju(year, month, day, hour) {
            try {
                const calendar = new KoreanLunarCalendar();
                calendar.setSolarDate(year, month, day);
                
                // ê°„ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (í•œì)
                const gapja = calendar.getChineseGapja();
                
                // í•œìë¥¼ í•œê¸€ë¡œ ë³€í™˜
                const yearPillar = chineseToKorean(gapja.year.replace('å¹´', ''));
                const monthPillar = chineseToKorean(gapja.month.replace('æœˆ', ''));
                const dayPillar = chineseToKorean(gapja.day.replace('æ—¥', ''));
                
                // ì‹œì£¼ ê³„ì‚°
                const hourBranchIndex = Math.floor((hour + 1) / 2) % 12;
                const hourBranch = earthlyBranches[hourBranchIndex];
                const dayStem = dayPillar[0]; // ì¼ê°„
                const hourStem = getHourStem(dayStem, hourBranch);
                const hourPillar = hourStem + hourBranch;
                
                return {
                    year: yearPillar,
                    month: monthPillar,
                    day: dayPillar,
                    hour: hourPillar
                };
            } catch (error) {
                console.error('ì‚¬ì£¼ ê³„ì‚° ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        async function analyzeSaju() {
            const birthDate = document.getElementById('birthDate').value;
            const birthHour = document.getElementById('birthHour').value;
            const gender = document.getElementById('gender').value;
            
            if (!birthDate || !birthHour || !gender) {
                alert('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const date = new Date(birthDate);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hour = parseInt(birthHour);
            
            // ì‚¬ì£¼ ê³„ì‚° (í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€)
            const saju = calculateSaju(year, month, day, hour);
            
            if (!saju) {
                alert('ì‚¬ì£¼ ê³„ì‚°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                document.getElementById('loading').style.display = 'none';
                return;
            }
            
            // ì‚¬ì£¼ í‘œì‹œ
            document.getElementById('yearPillar').textContent = saju.year;
            document.getElementById('monthPillar').textContent = saju.month;
            document.getElementById('dayPillar').textContent = saju.day;
            document.getElementById('hourPillar').textContent = saju.hour;
            
            // ë¡œë”© í‘œì‹œ
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').classList.remove('show');
            
            try {
                // Claude API í˜¸ì¶œ
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{
                            role: 'user',
                            content: `ë‹¹ì‹ ì€ ì „ë¬¸ ì‚¬ì£¼ ìƒë‹´ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ì‚¬ì£¼ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:

ìƒë…„ì›”ì¼: ${year}ë…„ ${month}ì›” ${day}ì¼
íƒœì–´ë‚œ ì‹œê°„: ${hour}ì‹œ
ì„±ë³„: ${gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}

ì‚¬ì£¼íŒ”ì:
- ë…„ì£¼: ${saju.year}
- ì›”ì£¼: ${saju.month}
- ì¼ì£¼: ${saju.day}
- ì‹œì£¼: ${saju.hour}

ë‹¤ìŒ í•­ëª©ë“¤ì„ ê°ê° 2-3ë¬¸ì¥ìœ¼ë¡œ êµ¬ì²´ì ì´ê³  ê¸ì •ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ê²°í˜¼ìš´
2. ì—°ì• ìš´
3. ì§ì¥ìš´
4. ì‚¬ì—…ìš´
5. 2026ë…„ ìš´ì„¸
6. MBTI ì„±í–¥ (ì´ ì‚¬ì£¼ë¥¼ ê°€ì§„ ì‚¬ëŒê³¼ ê°€ì¥ ìœ ì‚¬í•œ MBTI ìœ í˜• 1-2ê°œë¥¼ ì¶”ì²œí•˜ê³ , ê·¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”)

ê° í•­ëª©ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ì‘ì„±í•´ì£¼ì„¸ìš”.`
                        }]
                    })
                });
                
                const data = await response.json();
                const analysis = data.content[0].text;
                
                // ì‘ë‹µ íŒŒì‹± ë° í‘œì‹œ
                parseAndDisplayFortune(analysis);
                
                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('result').classList.add('show');
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                alert('ìš´ì„¸ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Claude API ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                console.error(error);
                
                // ë°ëª¨ìš© ê¸°ë³¸ í…ìŠ¤íŠ¸
                displayDemoFortune(saju);
                document.getElementById('result').classList.add('show');
            }
        }
        
        function parseAndDisplayFortune(analysis) {
            // ê°„ë‹¨í•œ íŒŒì‹± (ì‹¤ì œë¡œëŠ” ë” ì •êµí•œ íŒŒì‹± í•„ìš”)
            const sections = analysis.split(/\d\.\s+/);
            
            if (sections.length >= 7) {
                document.getElementById('marriageFortune').textContent = sections[1].trim();
                document.getElementById('loveFortune').textContent = sections[2].trim();
                document.getElementById('careerFortune').textContent = sections[3].trim();
                document.getElementById('businessFortune').textContent = sections[4].trim();
                document.getElementById('yearFortune').textContent = sections[5].trim();
                document.getElementById('mbtiFortune').textContent = sections[6].trim();
            } else {
                displayDemoFortune();
            }
        }
        
        function displayDemoFortune(saju) {
            document.getElementById('marriageFortune').textContent = 
                'ë‹¹ì‹ ì˜ ì‚¬ì£¼ëŠ” ë°°ìš°ìì™€ì˜ ì¸ì—°ì´ ê¹Šì€ í¸ì…ë‹ˆë‹¤. ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³  ì´í•´í•˜ëŠ” ê´€ê³„ë¥¼ í˜•ì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì¤‘ë…„ ì´í›„ ë”ìš± ì•ˆì •ì ì¸ ê²°í˜¼ ìƒí™œì„ ì˜ìœ„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            
            document.getElementById('loveFortune').textContent = 
                'ì—°ì• ì— ìˆì–´ì„œ ì§„ì§€í•˜ê³  ì±…ì„ê° ìˆëŠ” íƒœë„ë¥¼ ë³´ì…ë‹ˆë‹¤. ê°ì • í‘œí˜„ì— ë‹¤ì†Œ ì„œíˆ´ ìˆ˜ ìˆìœ¼ë‚˜, ì§„ì‹¬ì„ ë‹´ì•„ ìƒëŒ€ë°©ì„ ëŒ€í•˜ëŠ” ëª¨ìŠµì´ ë§¤ë ¥ì ì…ë‹ˆë‹¤. ì˜¬í•´ëŠ” ìƒˆë¡œìš´ ì¸ì—°ì„ ë§Œë‚  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.';
            
            document.getElementById('careerFortune').textContent = 
                'ì§ì¥ì—ì„œì˜ ì„±ì‹¤í•¨ê³¼ ì±…ì„ê°ì´ ì¸ì •ë°›ì•„ ìŠ¹ì§„ì´ë‚˜ ì¤‘ìš”í•œ í”„ë¡œì íŠ¸ë¥¼ ë§¡ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒì‚¬ì™€ì˜ ê´€ê³„ë„ ì›ë§Œí•˜ë©°, ë™ë£Œë“¤ê³¼ì˜ í˜‘ë ¥ì„ í†µí•´ ì¢‹ì€ ì„±ê³¼ë¥¼ ê±°ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            
            document.getElementById('businessFortune').textContent = 
                'ì‚¬ì—…ì„ ì‹œì‘í•˜ê±°ë‚˜ í™•ì¥í•˜ê¸°ì— ì¢‹ì€ ì‹œê¸°ì…ë‹ˆë‹¤. íŠ¹íˆ ì‹ ì¤‘í•œ íŒë‹¨ê³¼ ê³„íšì ì¸ íˆ¬ìê°€ ì„±ê³µì„ ê°€ì ¸ì˜¬ ê²ƒì…ë‹ˆë‹¤. íŒŒíŠ¸ë„ˆì‹­ì„ í†µí•œ ì‚¬ì—…ì´ ìœ ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            
            document.getElementById('yearFortune').textContent = 
                '2026ë…„ì€ ì „ë°˜ì ìœ¼ë¡œ ì•ˆì •ì ì´ê³  ë°œì „ì ì¸ í•œ í•´ê°€ ë  ê²ƒì…ë‹ˆë‹¤. ìƒë°˜ê¸°ì—ëŠ” ê³„íšì„ ì„¸ìš°ê³  ì¤€ë¹„í•˜ëŠ” ì‹œê¸°ì´ë©°, í•˜ë°˜ê¸°ì—ëŠ” ê·¸ ê²°ì‹¤ì„ ë§ºì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê±´ê°• ê´€ë¦¬ì— ì‹ ê²½ ì“°ë©´ì„œ ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ì„¸ìš”.';
            
            document.getElementById('mbtiFortune').textContent = 
                'ë‹¹ì‹ ì˜ ì‚¬ì£¼ëŠ” INFJ ë˜ëŠ” INTJ ì„±í–¥ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. ê¹Šì´ ìˆëŠ” ì‚¬ê³ ì™€ í†µì°°ë ¥ì„ ì§€ë‹ˆê³  ìˆìœ¼ë©°, ê³„íšì ì´ê³  ëª©í‘œ ì§€í–¥ì ì¸ ì„±ê²©ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë‚´ë©´ì˜ ì„¸ê³„ê°€ í’ë¶€í•˜ë©°, ì‹ ì¤‘í•˜ê²Œ ê²°ì •ì„ ë‚´ë¦¬ëŠ” í¸ì…ë‹ˆë‹¤.';
        }
    </script>
</body>
</html>
